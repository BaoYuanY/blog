<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="BaoYuan">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
        
            <link rel="preconnect" href="https://npm.elemecdn.com" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/centos-build-dnmp/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="在Docker中搭建dnmp(PHP开发环境)">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux使用Docker搭建PHP开发环境">
<meta property="og:url" content="http://example.com/centos-build-dnmp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="在Docker中搭建dnmp(PHP开发环境)">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-06-14T16:00:00.000Z">
<meta property="article:modified_time" content="2023-08-14T01:31:37.505Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="dnmp">
<meta name="twitter:card" content="summary">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="https://baoyuan-blog.oss-cn-shanghai.aliyuncs.com/IMG_0304.PNG" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="https://baoyuan-blog.oss-cn-shanghai.aliyuncs.com/IMG_0304.PNG">
    <meta name="theme-color" content="#F08080">
    <link rel="shortcut icon" href="https://baoyuan-blog.oss-cn-shanghai.aliyuncs.com/IMG_0304.PNG">
    <!--- Page Info-->
    
    <title>
        
            Linux使用Docker搭建PHP开发环境 -
        
        BaoYuan的博客
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fonts/fonts.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fonts/Satoshi/satoshi.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fonts/Chillax/chillax.css">
    <!--- Font Part-->
    
    
    
        <link href="" rel="stylesheet">
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":["0304"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":false,"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#F08080","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null},"busuanzi_counter":{"enable":false,"site_pv":false,"site_uv":false,"post_pv":false},"pjax":true},"home_banner":{"enable":true,"style":"static","image":{"light":"https://baoyuan-upload-file.oss-cn-beijing.aliyuncs.com/mountain.png","dark":"https://baoyuan-upload-file.oss-cn-beijing.aliyuncs.com/mountain.png"},"title":"君子不以冥冥堕行","subtitle":{"text":["饭可以一日不吃","觉可以一日不睡","书不可以一日不读"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":null,"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.3.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-solid fa-house"},"Docs":{"path":"https://docs.yangbaoyuan.cn/","icon":"fa-solid fa-book"}},"search":{"enable":true,"preload":true},"tags":{"Tags":{"icon":"fa-solid fa-tags","path":"/tags/"}},"categories":{"Categories":{"icon":"fa-solid fa-folder","path":"/categories/"}}},"page_templates":{"friends_column":2,"tags_style":"cloud"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"info","announcement":null,"links":{"Email":{"path":"https://mail.163.com/","icon":"fa-solid fa-envelope"}}},"article_date_format":"YYYY-MM-DD","categories":{"enable":true,"limit":5},"tags":{"enable":true,"limit":5}},"footerStart":"2023/5/23 18:00:00"};
    Global.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    Global.data_config = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">
    

    

    <div class="main-content-container">
        

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://baoyuan-blog.oss-cn-shanghai.aliyuncs.com/IMG_0304.PNG">
                </a>
            
            <a class="logo-title" href="/">
                
                BaoYuan的博客
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-solid fa-house"></i>
                                        
                                        首页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    target="_blank" rel="noopener" href="https://docs.yangbaoyuan.cn/"  >
                                    
                                        
                                            <i class="fa-solid fa-book"></i>
                                        
                                        DOCS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-solid fa-house"></i>
                                
                                首页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        target="_blank" rel="noopener" href="https://docs.yangbaoyuan.cn/"  >
                             
                                
                                    <i class="fa-solid fa-book"></i>
                                
                                DOCS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title">
            
                <h1 class="article-title-regular">Linux使用Docker搭建PHP开发环境</h1>
            
            </div>
            
                    
        
        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://baoyuan-blog.oss-cn-shanghai.aliyuncs.com/IMG_0304.PNG">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">BaoYuan</span>
                        
                            <span class="author-label">0304</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-06-15</span>
        <span class="mobile">2023-06-15</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-08-14 09:31:37</span>
            <span class="mobile">2023-08-14 09:31:37</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Docker/">Docker</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Docker/PHP/">PHP</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/dnmp/">dnmp</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>3k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>12 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="一-Docker安装"><a href="#一-Docker安装" class="headerlink" title="一. Docker安装"></a>一. Docker安装</h1><a class="button  regular" href='/linux-insert-docker' title='Linux安装Docker'><i class='fa-solid fa-newspaper'></i> Linux安装Docker</a>

<h1 id="二-安装-docker-compose"><a href="#二-安装-docker-compose" class="headerlink" title="二. 安装 docker-compose"></a>二. 安装 <code>docker-compose</code></h1><h3 id="1-下载"><a href="#1-下载" class="headerlink" title="1. 下载"></a>1. 下载</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment">#慢的话可以用这个</span></span><br><span class="line">sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.1/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></div>

<h3 id="2-设置权限"><a href="#2-设置权限" class="headerlink" title="2. 设置权限"></a>2. 设置权限</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></div>

<h3 id="3-验证"><a href="#3-验证" class="headerlink" title="3. 验证"></a>3. 验证</h3><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure></div>

<h1 id="三-拉取dnmp环境配置"><a href="#三-拉取dnmp环境配置" class="headerlink" title="三. 拉取dnmp环境配置"></a>三. 拉取dnmp环境配置</h1><p>按需拉取 随便放在一个地方</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b Linux https://github.com/BaoYuanY/dnmp.git</span><br></pre></td></tr></table></figure></div>

<h1 id="四-配置"><a href="#四-配置" class="headerlink" title="四. 配置"></a>四. 配置</h1><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /www              <span class="comment">#设置挂载目录</span></span><br><span class="line"><span class="built_in">cd</span> /www            </span><br><span class="line">git <span class="built_in">clone</span> ******        <span class="comment">#克隆dnmp代码 </span></span><br><span class="line">vim .<span class="built_in">env</span>                <span class="comment">#编辑 .env</span></span><br><span class="line"><span class="comment">#修改 SOURCE_DIR=/www  </span></span><br></pre></td></tr></table></figure></div>
<p>在dnmp目录下执行</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d  <span class="comment">#第一次会先build 时间稍微长一点</span></span><br></pre></td></tr></table></figure></div>


<p><b>然后配置自己的nginx的*****.conf文件</b></p>
<p>DNMP项目特点：</p>
<ol>
<li><code>100%</code>开源</li>
<li><code>100%</code>遵循Docker标准</li>
<li>支持<strong>多版本PHP</strong>共存，可任意切换（PHP5.4、PHP5.6、PHP7.1、PHP7.2、PHP7.3、PHP8.0)</li>
<li>支持绑定<strong>任意多个域名</strong></li>
<li>支持<strong>HTTPS和HTTP&#x2F;2</strong></li>
<li><strong>PHP源代码、MySQL数据、配置文件、日志文件</strong>都可在Host中直接修改查看</li>
<li>内置<strong>完整PHP扩展安装</strong>命令</li>
<li>默认支持<code>pdo_mysql</code>、<code>mysqli</code>、<code>mbstring</code>、<code>gd</code>、<code>curl</code>、<code>opcache</code>等常用热门扩展，根据环境灵活配置</li>
<li>可一键选配常用服务：<ul>
<li>多PHP版本：PHP5.4、PHP5.6、PHP7.1-7.3、PHP8.0</li>
<li>Web服务：Nginx、Openresty</li>
<li>数据库：MySQL5、MySQL8、Redis、memcached、MongoDB、ElasticSearch</li>
<li>消息队列：RabbitMQ</li>
<li>辅助工具：Kibana、Logstash、phpMyAdmin、phpRedisAdmin、AdminMongo</li>
</ul>
</li>
<li>实际项目中应用，确保<code>100%</code>可用</li>
<li>所有镜像源于<a class="link"   target="_blank" rel="noopener" href="https://hub.docker.com/" >Docker官方仓库 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，安全可靠</li>
<li>一次配置，<strong>Windows、Linux、MacOs</strong>皆可用</li>
<li>支持快速安装扩展命令 <code>install-php-extensions apcu</code></li>
</ol>
<h1 id="五-dnmp详解"><a href="#五-dnmp详解" class="headerlink" title="五. dnmp详解"></a>五. dnmp详解</h1><h2 id="1-目录结构"><a href="#1-目录结构" class="headerlink" title="1.目录结构"></a>1.目录结构</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">├── data                        数据库数据目录</span><br><span class="line">│   ├── esdata                  ElasticSearch 数据目录</span><br><span class="line">│   ├── mongo                   MongoDB 数据目录</span><br><span class="line">│   ├── mysql                   MySQL8 数据目录</span><br><span class="line">│   └── mysql5                  MySQL5 数据目录</span><br><span class="line">├── services                    服务构建文件和配置文件目录</span><br><span class="line">│   ├── elasticsearch           ElasticSearch 配置文件目录</span><br><span class="line">│   ├── mysql                   MySQL8 配置文件目录</span><br><span class="line">│   ├── mysql5                  MySQL5 配置文件目录</span><br><span class="line">│   ├── nginx                   Nginx 配置文件目录</span><br><span class="line">│   ├── php                     PHP5.6 - PHP7.3 配置目录</span><br><span class="line">│   ├── php54                   PHP5.4 配置目录</span><br><span class="line">│   └── redis                   Redis 配置目录</span><br><span class="line">├── logs                        日志目录</span><br><span class="line">├── docker-compose.sample.yml   Docker 服务配置示例文件</span><br><span class="line">├── env.smaple                  环境配置示例文件</span><br><span class="line">└── www                         PHP 代码目录</span><br></pre></td></tr></table></figure></div>

<h2 id="2-快速使用"><a href="#2-快速使用" class="headerlink" title="2.快速使用"></a>2.快速使用</h2><ol>
<li>本地安装<ul>
<li><code>git</code></li>
<li><code>Docker</code>(系统需为Linux，Windows 10 Build 15063+，或MacOS 10.12+，且必须要<code>64</code>位）</li>
<li><code>docker-compose 1.7.0+</code></li>
</ul>
</li>
<li><code>clone</code>项目： <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/yeszao/dnmp.git</span><br></pre></td></tr></table></figure></div></li>
<li>如果不是<code>root</code>用户，还需将当前用户加入<code>docker</code>用户组： <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -a &#123;USER&#125; docker</span><br></pre></td></tr></table></figure></div></li>
<li>拷贝并命名配置文件（Windows系统请用<code>copy</code>命令），启动： <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd dnmp                                           # 进入项目目录</span><br><span class="line">cp env.sample .env                                # 复制环境变量文件</span><br><span class="line">cp docker-compose.sample.yml docker-compose.yml   # 复制 docker-compose 配置文件。默认启动3个服务：</span><br><span class="line">                                                   # Nginx、PHP7和MySQL8。要开启更多其他服务，如Redis、</span><br><span class="line">                                                   # PHP5.6、PHP5.4、MongoDB，ElasticSearch等，请删</span><br><span class="line">                                                   # 除服务块前的注释</span><br><span class="line">docker-compose up                                 # 启动</span><br></pre></td></tr></table></figure></div></li>
<li>在浏览器中访问：<code>http://localhost</code>或<code>https://localhost</code>(自签名HTTPS演示)就能看到效果，PHP代码在文件<code>./www/localhost/index.php</code>。</li>
</ol>
<h2 id="3-PHP和扩展"><a href="#3-PHP和扩展" class="headerlink" title="3.PHP和扩展"></a>3.PHP和扩展</h2><h3 id="3-1-切换Nginx使用的PHP版本"><a href="#3-1-切换Nginx使用的PHP版本" class="headerlink" title="3.1 切换Nginx使用的PHP版本"></a>3.1 切换Nginx使用的PHP版本</h3><p>首先，需要启动其他版本的PHP，比如PHP5.4，那就先在<code>docker-compose.yml</code>文件中删除PHP5.4前面的注释，再启动PHP5.4容器。</p>
<p>PHP5.4启动后，打开Nginx 配置，修改<code>fastcgi_pass</code>的主机地址，由<code>php</code>改为<code>php54</code>，如下：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_pass   php:9000;</span><br></pre></td></tr></table></figure></div>
<p>为：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_pass   php54:9000;</span><br></pre></td></tr></table></figure></div>
<p>其中 <code>php</code> 和 <code>php54</code> 是<code>docker-compose.yml</code>文件中服务器的名称。</p>
<p>最后，<strong>重启 Nginx</strong> 生效。</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it nginx nginx -s reload</span><br></pre></td></tr></table></figure></div>
<p>这里两个<code>nginx</code>，第一个是容器名，第二个是容器中的<code>nginx</code>程序。</p>
<h3 id="3-2-安装PHP扩展"><a href="#3-2-安装PHP扩展" class="headerlink" title="3.2 安装PHP扩展"></a>3.2 安装PHP扩展</h3><p>PHP的很多功能都是通过扩展实现，而安装扩展是一个略费时间的过程，<br>所以，除PHP内置扩展外，在<code>env.sample</code>文件中我们仅默认安装少量扩展，<br>如果要安装更多扩展，请打开你的<code>.env</code>文件修改如下的PHP配置，<br>增加需要的PHP扩展：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PHP_EXTENSIONS=pdo_mysql,opcache,redis       <span class="comment"># PHP 要安装的扩展列表，英文逗号隔开</span></span><br><span class="line">PHP54_EXTENSIONS=opcache,redis                 <span class="comment"># PHP 5.4要安装的扩展列表，英文逗号隔开</span></span><br></pre></td></tr></table></figure></div>
<p>然后重新build PHP镜像。</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build php</span><br></pre></td></tr></table></figure></div>
<p>可用的扩展请看同文件的<code>env.sample</code>注释块说明。</p>
<h3 id="3-3-快速安装php扩展"><a href="#3-3-快速安装php扩展" class="headerlink" title="3.3 快速安装php扩展"></a>3.3 快速安装php扩展</h3><p>1.进入容器:</p>
<div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it php /bin/sh</span><br><span class="line"></span><br><span class="line">install-php-extensions apcu </span><br></pre></td></tr></table></figure></div>
<p>2.支持快速安装扩展列表</p>
<!-- START OF EXTENSIONS TABLE -->
<!-- ########################################################### -->
<!-- #                                                         # -->
<!-- #  DO NOT EDIT THIS TABLE: IT IS GENERATED AUTOMATICALLY  # -->
<!-- #                                                         # -->
<!-- #  EDIT THE data/supported-extensions FILE INSTEAD        # -->
<!-- #                                                         # -->
<!-- ########################################################### -->

<p>来自<a class="link"   target="_blank" rel="noopener" href="https://github.com/mlocati/docker-php-extension-installer" >https://github.com/mlocati/docker-php-extension-installer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>参考示例文件</p>
<h3 id="3-4-Host中使用php命令行（php-cli）"><a href="#3-4-Host中使用php命令行（php-cli）" class="headerlink" title="3.4 Host中使用php命令行（php-cli）"></a>3.4 Host中使用php命令行（php-cli）</h3><ol>
<li>参考<a href="bash.alias.sample">bash.alias.sample</a>示例文件，将对应 php cli 函数拷贝到主机的 <code>~/.bashrc</code>文件。</li>
<li>让文件起效： <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></div></li>
<li>然后就可以在主机中执行php命令了： <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~ php -v</span><br><span class="line">PHP 7.2.13 (cli) (built: Dec 21 2018 02:22:47) ( NTS )</span><br><span class="line">Copyright (c) 1997-2018 The PHP Group</span><br><span class="line">Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies</span><br><span class="line">    with Zend OPcache v7.2.13, Copyright (c) 1999-2018, by Zend Technologies</span><br><span class="line">    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h3 id="3-5-使用composer"><a href="#3-5-使用composer" class="headerlink" title="3.5 使用composer"></a>3.5 使用composer</h3><p><strong>方法1：主机中使用composer命令</strong></p>
<ol>
<li>确定composer缓存的路径。比如，我的dnmp下载在<code>~/dnmp</code>目录，那composer的缓存路径就是<code>~/dnmp/data/composer</code>。</li>
<li>参考<a href="bash.alias.sample">bash.alias.sample</a>示例文件，将对应 php composer 函数拷贝到主机的 <code>~/.bashrc</code>文件。<blockquote>
<p>这里需要注意的是，示例文件中的<code>~/dnmp/data/composer</code>目录需是第一步确定的目录。</p>
</blockquote>
</li>
<li>让文件起效： <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></div></li>
<li>在主机的任何目录下就能用composer了： <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/dnmp/www/</span><br><span class="line">composer create-project yeszao/fastphp project --no-dev</span><br></pre></td></tr></table></figure></div></li>
<li>（可选）第一次使用 composer 会在 <code>~/dnmp/data/composer</code> 目录下生成一个<strong>config.json</strong>文件，可以在这个文件中指定国内仓库，例如： <div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;repositories&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;packagist&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;composer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://packagist.laravel-china.org&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<strong>方法二：容器内使用composer命令</strong></li>
</ol>
<p>还有另外一种方式，就是进入容器，再执行<code>composer</code>命令，以PHP7容器为例：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it php /bin/sh</span><br><span class="line"><span class="built_in">cd</span> /www/localhost</span><br><span class="line">composer update</span><br></pre></td></tr></table></figure></div>

<h2 id="4-管理命令"><a href="#4-管理命令" class="headerlink" title="4.管理命令"></a>4.管理命令</h2><h3 id="4-1-服务器启动和构建命令"><a href="#4-1-服务器启动和构建命令" class="headerlink" title="4.1 服务器启动和构建命令"></a>4.1 服务器启动和构建命令</h3><p>如需管理服务，请在命令后面加上服务器名称，例如：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up                         <span class="comment"># 创建并且启动所有容器</span></span><br><span class="line">docker-compose up -d                      <span class="comment"># 创建并且后台运行方式启动所有容器</span></span><br><span class="line">docker-compose up nginx php mysql         <span class="comment"># 创建并且启动nginx、php、mysql的多个容器</span></span><br><span class="line">docker-compose up -d nginx php  mysql     <span class="comment"># 创建并且已后台运行的方式启动nginx、php、mysql容器</span></span><br><span class="line">docker-compose start php                  <span class="comment"># 启动服务</span></span><br><span class="line">docker-compose stop php                   <span class="comment"># 停止服务</span></span><br><span class="line">docker-compose restart php                <span class="comment"># 重启服务</span></span><br><span class="line">docker-compose build php                  <span class="comment"># 构建或者重新构建服务</span></span><br><span class="line">docker-compose <span class="built_in">rm</span> php                     <span class="comment"># 删除并且停止php容器</span></span><br><span class="line">docker-compose down                       <span class="comment"># 停止并删除容器，网络，图像和挂载卷</span></span><br></pre></td></tr></table></figure></div>

<h3 id="4-2-添加快捷命令"><a href="#4-2-添加快捷命令" class="headerlink" title="4.2 添加快捷命令"></a>4.2 添加快捷命令</h3><p>在开发的时候，我们可能经常使用<code>docker exec -it</code>进入到容器中，把常用的做成命令别名是个省事的方法。</p>
<p>首先，在主机中查看可用的容器：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps           <span class="comment"># 查看所有运行中的容器</span></span><br><span class="line">docker ps -a        <span class="comment"># 所有容器</span></span><br></pre></td></tr></table></figure></div>
<p>输出的<code>NAMES</code>那一列就是容器的名称，如果使用默认配置，那么名称就是<code>nginx</code>、<code>php</code>、<code>php56</code>、<code>mysql</code>等。</p>
<p>然后，打开<code>~/.bashrc</code>或者<code>~/.zshrc</code>文件，加上：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> dnginx=<span class="string">&#x27;docker exec -it nginx /bin/sh&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dphp=<span class="string">&#x27;docker exec -it php /bin/sh&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dphp56=<span class="string">&#x27;docker exec -it php56 /bin/sh&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dphp54=<span class="string">&#x27;docker exec -it php54 /bin/sh&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dmysql=<span class="string">&#x27;docker exec -it mysql /bin/bash&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dredis=<span class="string">&#x27;docker exec -it redis /bin/sh&#x27;</span></span><br></pre></td></tr></table></figure></div>
<p>下次进入容器就非常快捷了，如进入php容器：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dphp</span><br></pre></td></tr></table></figure></div>

<h3 id="4-3-查看docker网络"><a href="#4-3-查看docker网络" class="headerlink" title="4.3 查看docker网络"></a>4.3 查看docker网络</h3><div class="highlight-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig docker0</span><br></pre></td></tr></table></figure></div>
<p>用于填写<code>extra_hosts</code>容器访问宿主机的<code>hosts</code>地址</p>
<h2 id="5-使用Log"><a href="#5-使用Log" class="headerlink" title="5.使用Log"></a>5.使用Log</h2><p>Log文件生成的位置依赖于conf下各log配置的值。</p>
<h3 id="5-1-Nginx日志"><a href="#5-1-Nginx日志" class="headerlink" title="5.1 Nginx日志"></a>5.1 Nginx日志</h3><p>Nginx日志是我们用得最多的日志，所以我们单独放在根目录<code>log</code>下。</p>
<p><code>log</code>会目录映射Nginx容器的<code>/var/log/nginx</code>目录，所以在Nginx配置文件中，需要输出log的位置，我们需要配置到<code>/var/log/nginx</code>目录，如：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log  /var/log/nginx/nginx.localhost.error.log  warn;</span><br></pre></td></tr></table></figure></div>


<h3 id="5-2-PHP-FPM日志"><a href="#5-2-PHP-FPM日志" class="headerlink" title="5.2 PHP-FPM日志"></a>5.2 PHP-FPM日志</h3><p>大部分情况下，PHP-FPM的日志都会输出到Nginx的日志中，所以不需要额外配置。</p>
<p>另外，建议直接在PHP中打开错误日志：</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;error_reporting&#x27;</span>, <span class="string">&#x27;on&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="string">&#x27;on&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<p>如果确实需要，可按一下步骤开启（在容器中）。</p>
<ol>
<li>进入容器，创建日志文件并修改权限： <div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it php /bin/sh</span><br><span class="line"><span class="built_in">mkdir</span> /var/log/php</span><br><span class="line"><span class="built_in">cd</span> /var/log/php</span><br><span class="line"><span class="built_in">touch</span> php-fpm.error.log</span><br><span class="line"><span class="built_in">chmod</span> a+w php-fpm.error.log</span><br></pre></td></tr></table></figure></div></li>
<li>主机上打开并修改PHP-FPM的配置文件<code>conf/php-fpm.conf</code>，找到如下一行，删除注释，并改值为： <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_admin_value[error_log] = /var/log/php/php-fpm.error.log</span><br></pre></td></tr></table></figure></div></li>
<li>重启PHP-FPM容器。</li>
</ol>
<h3 id="5-3-MySQL日志"><a href="#5-3-MySQL日志" class="headerlink" title="5.3 MySQL日志"></a>5.3 MySQL日志</h3><p>因为MySQL容器中的MySQL使用的是<code>mysql</code>用户启动，它无法自行在<code>/var/log</code>下的增加日志文件。所以，我们把MySQL的日志放在与data一样的目录，即项目的<code>mysql</code>目录下，对应容器中的<code>/var/lib/mysql/</code>目录。</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slow-query-log-file     = /var/lib/mysql/mysql.slow.log</span><br><span class="line">log-error               = /var/lib/mysql/mysql.error.log</span><br></pre></td></tr></table></figure></div>
<p>以上是mysql.conf中的日志文件的配置。</p>
<h2 id="6-数据库管理"><a href="#6-数据库管理" class="headerlink" title="6.数据库管理"></a>6.数据库管理</h2><p>本项目默认在<code>docker-compose.yml</code>中不开启了用于MySQL在线管理的<em>phpMyAdmin</em>，以及用于redis在线管理的<em>phpRedisAdmin</em>，可以根据需要修改或删除。</p>
<h3 id="6-1-phpMyAdmin"><a href="#6-1-phpMyAdmin" class="headerlink" title="6.1 phpMyAdmin"></a>6.1 phpMyAdmin</h3><p>phpMyAdmin容器映射到主机的端口地址是：<code>8080</code>，所以主机上访问phpMyAdmin的地址是：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080</span><br></pre></td></tr></table></figure></div>

<p>MySQL连接信息：</p>
<ul>
<li>host：(本项目的MySQL容器网络)</li>
<li>port：<code>3306</code></li>
<li>username：（手动在phpmyadmin界面输入）</li>
<li>password：（手动在phpmyadmin界面输入）</li>
</ul>
<h3 id="6-2-phpRedisAdmin"><a href="#6-2-phpRedisAdmin" class="headerlink" title="6.2 phpRedisAdmin"></a>6.2 phpRedisAdmin</h3><p>phpRedisAdmin容器映射到主机的端口地址是：<code>8081</code>，所以主机上访问phpMyAdmin的地址是：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8081</span><br></pre></td></tr></table></figure></div>

<p>Redis连接信息如下：</p>
<ul>
<li>host: (本项目的Redis容器网络)</li>
<li>port: <code>6379</code></li>
</ul>
<h2 id="7-在正式环境中安全使用"><a href="#7-在正式环境中安全使用" class="headerlink" title="7.在正式环境中安全使用"></a>7.在正式环境中安全使用</h2><p>要在正式环境中使用，请：</p>
<ol>
<li>在php.ini中关闭XDebug调试</li>
<li>增强MySQL数据库访问的安全策略</li>
<li>增强redis访问的安全策略</li>
</ol>
<h2 id="8-常见问题"><a href="#8-常见问题" class="headerlink" title="8 常见问题"></a>8 常见问题</h2><h3 id="8-1-如何在PHP代码中使用curl？"><a href="#8-1-如何在PHP代码中使用curl？" class="headerlink" title="8.1 如何在PHP代码中使用curl？"></a>8.1 如何在PHP代码中使用curl？</h3><p>参考这个issue：<a class="link"   target="_blank" rel="noopener" href="https://github.com/YBY-BaoYuan/dnmp/issues/91" >https://github.com/YBY-BaoYuan/dnmp/issues/91 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="8-2-Docker使用cron定时任务"><a href="#8-2-Docker使用cron定时任务" class="headerlink" title="8.2 Docker使用cron定时任务"></a>8.2 Docker使用cron定时任务</h3><p><a class="link"   target="_blank" rel="noopener" href="https://www.awaimai.com/2615.html" >Docker使用cron定时任务 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h3 id="8-3-Docker容器时间"><a href="#8-3-Docker容器时间" class="headerlink" title="8.3 Docker容器时间"></a>8.3 Docker容器时间</h3><p>容器时间在.env文件中配置<code>TZ</code>变量，所有支持的时区请看<a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" >时区列表·维基百科 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>或者<a class="link"   target="_blank" rel="noopener" href="https://www.php.net/manual/zh/timezones.php" >PHP所支持的时区列表·PHP官网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</p>
<h3 id="8-4-如何连接MySQL和Redis服务器"><a href="#8-4-如何连接MySQL和Redis服务器" class="headerlink" title="8.4 如何连接MySQL和Redis服务器"></a>8.4 如何连接MySQL和Redis服务器</h3><p>这要分两种情况，</p>
<p>第一种情况，在<strong>PHP代码中</strong>。</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接MySQL</span></span><br><span class="line">dbh = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;mysql:host=mysql;dbname=mysql&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接Redis</span></span><br><span class="line">redis = <span class="keyword">new</span> <span class="title class_">Redis</span>();</span><br><span class="line">redis-&gt;<span class="title function_ invoke__">connect</span>(<span class="string">&#x27;redis&#x27;</span>, <span class="number">6379</span>);</span><br></pre></td></tr></table></figure></div>
<p>因为容器与容器是<code>expose</code>端口联通的，而且在同一个<code>networks</code>下，所以连接的<code>host</code>参数直接用容器名称，<code>port</code>参数就是容器内部的端口。更多请参考<a class="link"   target="_blank" rel="noopener" href="https://www.awaimai.com/2138.html" >《docker-compose ports和expose的区别》 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>。</p>
<p>第二种情况，<strong>在主机中</strong>通过<strong>命令行</strong>或者<strong>Navicat</strong>等工具连接。主机要连接mysql和redis的话，要求容器必须经过<code>ports</code>把端口映射到主机了。以 mysql 为例，<code>docker-compose.yml</code>文件中有这样的<code>ports</code>配置：<code>3306:3306</code>，就是主机的3306和容器的3306端口形成了映射，所以我们可以这样连接：</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h127.0.0.1 -uroot -p123456 -P3306</span><br><span class="line">redis-cli -h127.0.0.1</span><br></pre></td></tr></table></figure></div>
<p>这里<code>host</code>参数不能用localhost是因为它默认是通过sock文件与mysql通信，而容器与主机文件系统已经隔离，所以需要通过TCP方式连接，所以需要指定IP。</p>
<h3 id="8-5-容器内的php如何连接宿主机MySQL"><a href="#8-5-容器内的php如何连接宿主机MySQL" class="headerlink" title="8.5 容器内的php如何连接宿主机MySQL"></a>8.5 容器内的php如何连接宿主机MySQL</h3><p>1.宿主机执行<code>ifconfig docker0</code>得到<code>inet</code>就是要连接的<code>ip</code>地址</p>
<div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> ifconfig docker0</span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure></div>
<p>2.运行宿主机Mysql命令行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27; WITH GRANT OPTION;</span><br><span class="line"> mysql&gt;flush privileges;</span><br><span class="line">// 其中各字符的含义：</span><br><span class="line">// *.* 对任意数据库任意表有效</span><br><span class="line">// &quot;root&quot; &quot;123456&quot; 是数据库用户名和密码</span><br><span class="line">// &#x27;%&#x27; 允许访问数据库的IP地址，%意思是任意IP，也可以指定IP</span><br><span class="line">// flush privileges 刷新权限信息</span><br></pre></td></tr></table></figure></div>

<p>3.接着直接php容器使用<code>172.0.17.1:3306</code>连接即可</p>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT</p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/dnmp/">#dnmp</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                        rel="prev"
                        href="/build-admin-yangbaoyuan/"
                        >
                            <span class="left arrow-icon flex-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Laravel</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                        rel="next"
                        href="/php-function/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">PHP一些函数方法汇总</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">Linux使用Docker搭建PHP开发环境</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80-Docker%E5%AE%89%E8%A3%85"><span class="nav-text">一. Docker安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C-%E5%AE%89%E8%A3%85-docker-compose"><span class="nav-text">二. 安装 docker-compose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%8B%E8%BD%BD"><span class="nav-text">1. 下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%AE%BE%E7%BD%AE%E6%9D%83%E9%99%90"><span class="nav-text">2. 设置权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%AA%8C%E8%AF%81"><span class="nav-text">3. 验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89-%E6%8B%89%E5%8F%96dnmp%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-text">三. 拉取dnmp环境配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B-%E9%85%8D%E7%BD%AE"><span class="nav-text">四. 配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94-dnmp%E8%AF%A6%E8%A7%A3"><span class="nav-text">五. dnmp详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text">1.目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8"><span class="nav-text">2.快速使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-PHP%E5%92%8C%E6%89%A9%E5%B1%95"><span class="nav-text">3.PHP和扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%88%87%E6%8D%A2Nginx%E4%BD%BF%E7%94%A8%E7%9A%84PHP%E7%89%88%E6%9C%AC"><span class="nav-text">3.1 切换Nginx使用的PHP版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%89%E8%A3%85PHP%E6%89%A9%E5%B1%95"><span class="nav-text">3.2 安装PHP扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85php%E6%89%A9%E5%B1%95"><span class="nav-text">3.3 快速安装php扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Host%E4%B8%AD%E4%BD%BF%E7%94%A8php%E5%91%BD%E4%BB%A4%E8%A1%8C%EF%BC%88php-cli%EF%BC%89"><span class="nav-text">3.4 Host中使用php命令行（php-cli）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E4%BD%BF%E7%94%A8composer"><span class="nav-text">3.5 使用composer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="nav-text">4.管理命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%8A%A8%E5%92%8C%E6%9E%84%E5%BB%BA%E5%91%BD%E4%BB%A4"><span class="nav-text">4.1 服务器启动和构建命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%B7%BB%E5%8A%A0%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4"><span class="nav-text">4.2 添加快捷命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E6%9F%A5%E7%9C%8Bdocker%E7%BD%91%E7%BB%9C"><span class="nav-text">4.3 查看docker网络</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%BD%BF%E7%94%A8Log"><span class="nav-text">5.使用Log</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Nginx%E6%97%A5%E5%BF%97"><span class="nav-text">5.1 Nginx日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-PHP-FPM%E6%97%A5%E5%BF%97"><span class="nav-text">5.2 PHP-FPM日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-MySQL%E6%97%A5%E5%BF%97"><span class="nav-text">5.3 MySQL日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86"><span class="nav-text">6.数据库管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-phpMyAdmin"><span class="nav-text">6.1 phpMyAdmin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-phpRedisAdmin"><span class="nav-text">6.2 phpRedisAdmin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%9C%A8%E6%AD%A3%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%AE%89%E5%85%A8%E4%BD%BF%E7%94%A8"><span class="nav-text">7.在正式环境中安全使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-text">8 常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E5%A6%82%E4%BD%95%E5%9C%A8PHP%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%BD%BF%E7%94%A8curl%EF%BC%9F"><span class="nav-text">8.1 如何在PHP代码中使用curl？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-Docker%E4%BD%BF%E7%94%A8cron%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-text">8.2 Docker使用cron定时任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-Docker%E5%AE%B9%E5%99%A8%E6%97%B6%E9%97%B4"><span class="nav-text">8.3 Docker容器时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5MySQL%E5%92%8CRedis%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">8.4 如何连接MySQL和Redis服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-%E5%AE%B9%E5%99%A8%E5%86%85%E7%9A%84php%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E5%AE%BF%E4%B8%BB%E6%9C%BAMySQL"><span class="nav-text">8.5 容器内的php如何连接宿主机MySQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#License"><span class="nav-text">License</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">BaoYuan</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> 驱动</span>
                <br>
            <span class="theme-version-container">主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.3.0</a></span>
        </div>
        
            <div class="icp-info info-item"><a target="_blank" rel="nofollow" href="
                
                    https://beian.miit.gov.cn/
                
                ">豫ICP备2023010776号-1</a></div>
        
        
        
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>

<script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/SwupScrollPlugin.min.js"></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
        ],
        containers: ["#swup"],
    });

    swup.on("pageView", () => {
        Global.refresh();
    });

    // if (document.readyState === "complete") {
    //
    // } else {
    //     document.addEventListener("DOMContentLoaded", () => init());
    // }
</script>




<script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/utils.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/main.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/layouts/navbarShrink.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/tools/scrollTopBottom.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/tools/lightDarkSwitch.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/layouts/categoryList.js"></script>


    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/tools/localSearch.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/tools/codeBlock.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/layouts/lazyload.js"></script>





  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/Typed.min.js"></script>
  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/plugins/typed.js"></script>






<div class="post-scripts" data-swup-reload-script>
    
        <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/tools/tocToggle.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/layouts/toc.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/libs/anime.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.3.0/source/js/plugins/tabs.js"></script>
    
</div>


</body>
</html>
